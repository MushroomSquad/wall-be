# Настройка расписания резервного копирования

**Language / Язык**: [English](en/cron.md) | [Русский](cron.md)

Этот документ объясняет, как настроить расписание резервного копирования с использованием cron и wall-be.

## Настройка расписания резервного копирования

wall-be можно легко интегрировать с cron для автоматизации процессов резервного копирования.

### Использование встроенного планировщика

wall-be предоставляет команду schedule для упрощения настройки заданий cron:

```bash
./wall-be.sh mysql schedule --interval daily
# или
./wall-be.sh postgresql schedule --interval weekly
```

Доступные интервалы:
- `hourly` (ежечасно)
- `daily` (ежедневно)
- `weekly` (еженедельно)
- `monthly` (ежемесячно)

### Пользовательское расписание с синтаксисом Cron

Для большего контроля вы можете указать собственное расписание cron:

```bash
./wall-be.sh mysql schedule --cron "0 2 * * *"
```

Этот пример планирует резервное копирование каждый день в 2:00.

## Просмотр запланированных резервных копий

Чтобы увидеть все текущие запланированные резервные копии:

```bash
./wall-be.sh mysql schedule --list
# или
./wall-be.sh postgresql schedule --list
```

## Удаление запланированных резервных копий

Чтобы удалить запланированное резервное копирование:

```bash
./wall-be.sh mysql schedule --remove daily
# или
./wall-be.sh postgresql schedule --remove "0 2 * * *"
```

## Ручная настройка Cron

Если вы предпочитаете настраивать задания cron вручную, вы можете добавить записи непосредственно в crontab:

```bash
crontab -e
```

Затем добавьте строки вроде:

```
# Ежедневное резервное копирование MySQL в 2:00
0 2 * * * /path/to/wall-be.sh mysql backup --config /path/to/config-mysql.env

# Еженедельное резервное копирование PostgreSQL в воскресенье в 3:00
0 3 * * 0 /path/to/wall-be.sh postgresql backup --config /path/to/config-postgresql.env
```

## Расширенное планирование

### Политики хранения

Вы можете комбинировать запланированные резервные копии с автоматическими политиками хранения:

```bash
./wall-be.sh mysql schedule --interval daily --apply-retention
```

Это будет создавать ежедневные резервные копии и автоматически применять политики хранения.

### Уведомление при сбое

Чтобы получать уведомления только при сбое резервного копирования:

```bash
./wall-be.sh mysql schedule --interval daily --alert-on-error
```

Настройте адрес электронной почты или webhook Slack в вашем конфигурационном файле.

### Ведение журнала

Запланированные резервные копии будут записывать в журнал:
- `/var/log/wall-be/` (при запуске от имени root)
- `./logs/` (при запуске от имени обычного пользователя)

Вы можете указать пользовательский файл журнала:

```bash
./wall-be.sh mysql schedule --interval daily --log-file /path/to/logfile.log
```

## Системная интеграция

### Таймеры Systemd

В качестве альтернативы cron, вы можете использовать таймеры systemd для планирования резервного копирования:

```bash
./wall-be.sh mysql schedule --use-systemd --interval daily
```

Это создаст и включит блок таймера systemd для резервного копирования.

### Планирование Docker

Для развертываний Docker смотрите [Руководство по интеграции Docker](docker.md) для получения информации о вариантах планирования. 