# Управление резервными копиями

**Language / Язык**: [English](en/backup.md) | [Русский](backup_management.md)

Этот документ описывает, как создавать и управлять резервными копиями с использованием wall-be.

## Создание резервных копий

wall-be предоставляет простой способ создания резервных копий для ваших баз данных.

### Полные резервные копии

Для создания полной резервной копии вашей базы данных:

```bash
./wall-be.sh mysql backup  # Для MySQL
# или
./wall-be.sh postgresql backup  # Для PostgreSQL
```

По умолчанию это создает резервную копию с автоматически сгенерированным именем. Резервная копия включает все данные, необходимые для восстановления вашей базы данных до момента создания резервной копии.

### Резервная копия с пользовательским именем

Вы можете указать пользовательское имя для вашей резервной копии:

```bash
./wall-be.sh mysql backup --name my_custom_backup
```

### Инкрементальные резервные копии

Для баз данных, поддерживающих инкрементальные резервные копии (например, PostgreSQL), wall-be автоматически обрабатывает архивирование WAL и функциональность инкрементального резервного копирования.

Для включения инкрементальных резервных копий для MySQL настройте параметры дельта-копий в вашем конфигурационном файле:

```bash
WALG_DELTA_MAX_STEPS=7       # Количество дельта-копий между полными резервными копиями
WALG_DELTA_ORIGIN=LATEST     # Базовая резервная копия для цепочек дельта-копий
```

## Просмотр списка резервных копий

Для просмотра списка доступных резервных копий:

```bash
./wall-be.sh mysql list  # Для MySQL
# или
./wall-be.sh postgresql list  # Для PostgreSQL
```

Эта команда отображает:
- Имена резервных копий
- Время создания
- Размер резервной копии
- Тип резервной копии (полная или инкрементальная)

## Проверка резервных копий

Важно регулярно проверять ваши резервные копии, чтобы убедиться, что их можно использовать для восстановления.

### Базовая проверка

```bash
./wall-be.sh mysql verify --name LATEST  # Проверка последней резервной копии MySQL
# или
./wall-be.sh postgresql verify --name base_000000010000000000000001  # Проверка конкретной резервной копии PostgreSQL
```

### Детальная проверка

Для более тщательной проверки, включая проверку целостности данных:

```bash
./wall-be.sh mysql verify --name LATEST --detailed
```

## Хранение резервных копий

wall-be позволяет настраивать политики хранения резервных копий для автоматического управления хранилищем резервных копий.

Настройте хранение в вашем конфигурационном файле:

```bash
# Хранить 7 последних полных резервных копий
WALG_RETENTION_FULL_BACKUPS=7

# Хранить резервные копии в течение 30 дней
WALG_RETENTION_DAYS=30

# Хранить всего 10 резервных копий
WALG_RETENTION_COUNT=10
```

Для ручного применения политик хранения:

```bash
./wall-be.sh mysql backup --apply-retention
```

## Мониторинг статуса резервного копирования

### Журналы резервного копирования

Журналы резервного копирования хранятся в:
- `/var/log/wall-be/` (при запуске от имени root)
- `./logs/` (при запуске от имени обычного пользователя)

### Уведомления по электронной почте

Настройте уведомления по электронной почте в вашем конфигурационном файле:

```bash
BACKUP_ALERT_EMAIL=admin@example.com
BACKUP_ALERT_ON_SUCCESS=true
BACKUP_ALERT_ON_ERROR=true
```

### Уведомления в Slack

Настройте уведомления в Slack:

```bash
BACKUP_SLACK_WEBHOOK=https://hooks.slack.com/services/xxx/yyy/zzz
```

## Устранение неполадок при резервном копировании

Если вы столкнулись с проблемами при резервном копировании, обратитесь к [Руководству по устранению неполадок](troubleshooting.md). 